!function(){function a(a){var c=a.getAttribute("data-src"),d=c+"&type="+f.defaultVoice;!0===f.autoAudio&&b(d),a.addEventListener("click",function(a){b(d)})}function b(a){chrome.runtime.sendMessage({type:"voice",src:a})}function c(a,b){return a.top===b.top&&a.bottom===b.bottom&&a.left===b.left&&a.right===b.right}var d,e={top:0,bottom:0,left:0,right:0,again:0},f={};chrome.storage.sync.get(null,function(a){for(var b in a)f[b]=a[b]}),chrome.storage.onChanged.addListener(function(a){void 0!==a.linkQuery&&(f.linkQuery=a.linkQuery.newValue),void 0!==a.useHttps&&(f.useHttps=a.useHttps.newValue),void 0!==a.autoAudio&&(f.autoAudio=a.autoAudio.newValue),void 0!==a.defaultVoice&&(f.defaultVoice=a.defaultVoice.newValue),void 0!==a.selectMode&&(f.selectMode=a.selectMode.newValue),void 0!==a.toggleKey&&(f.toggleKey=a.toggleKey.newValue),void 0!==a.autoHide&&(f.autoHide=a.autoHide.newValue),void 0!==a.showDuration&&(f.showDuration=a.showDuration.newValue),void 0!==a.showPosition&&(f.showPosition=a.showPosition.newValue)});var g=function(a){var b=window.getSelection&&window.getSelection();if(b&&b.rangeCount>0){var d=trim(b.toString()),g=b.getRangeAt(0).getBoundingClientRect();if(c(g,e)&&e.again)return void(e.again=0);if(""===d)return;for(var j=document.documentElement.querySelectorAll(".ChaZD-result-container"),k=0,l=j.length;k<l;k++)if(j[k].getAttribute("data-text").toLowerCase()===d.toLowerCase())return;chrome.storage.sync.set({currentWord:d},function(){});for(var m in e)e[m]="again"==m?1:g[m];"side"===f.showPosition&&h(d,f.useHttps),"near"===f.showPosition&&i(d,f.useHttps,g,a)}},h=function(a,b){var c=k(a,b);c.classList.add("ChaZD-result-side"),document.documentElement.appendChild(c),f.autoHide&&(d=setTimeout(function(){document.querySelector(".ChaZD-result-container")&&document.documentElement.removeChild(c)},1e3*f.showDuration))},i=function(a,b,c,e){var g=k(a,b),h=j();document.documentElement.appendChild(g),document.documentElement.appendChild(h);var i={};0===c.left&&0===c.top&&(c={left:e.clientX,top:e.clientY,height:15});var l=g.offsetWidth,m=c.right-c.left,n=c.left+window.pageXOffset,o=c.top+window.pageYOffset,p=m/2+n,q=n-(l-m)/2,r=p-12;q<window.pageXOffset?q=window.pageXOffset:q+l>window.pageXOffset+document.documentElement.clientWidth&&(q=window.pageXOffset+document.documentElement.clientWidth-l);var s=0;if(s=document.documentElement.clientHeight>document.body.clientHeight?document.body.clientHeight:document.documentElement.clientHeight,0===s&&(s=document.documentElement.clientHeight),c.top>=150){var t=s-o+10;i={left:q,bottom:t,arrowLeft:r,arrowBottom:t+1}}else i={left:q,top:o+c.height+12,arrowLeft:r,arrowTop:o+c.height+1};g.style.left=i.left+"px",h.style.left=i.arrowLeft+"px";var u,v,w=document.querySelectorAll(".ChaZD-arrow-outer"),x=document.querySelectorAll(".ChaZD-arrow-inner");if(i.bottom)for(g.style.bottom=i.bottom+"px",h.style.bottom=i.arrowBottom+"px",u=0,v=w.length;u<v;u++)w[u].classList.add("ChaZD-arrow-outer-down"),x[u].classList.add("ChaZD-arrow-inner-down");if(i.top)for(g.style.top=i.top+"px",h.style.top=i.arrowTop+"px",u=0,v=w.length;u<v;u++)w[u].classList.add("ChaZD-arrow-outer-up"),x[u].classList.add("ChaZD-arrow-inner-up");f.autoHide&&(d=setTimeout(function(){document.querySelector(".ChaZD-result-container")&&document.querySelector(".ChaZD-arrow-main")&&(document.documentElement.removeChild(g),document.documentElement.removeChild(h))},1e3*f.showDuration))},j=function(){var a=document.createElement("div");a.classList.add("ChaZD-arrow-main");var b=document.createElement("div");b.setAttribute("class","ChaZD-arrow-outer");var c=document.createElement("div");return c.setAttribute("class","ChaZD-arrow-inner"),a.appendChild(b),a.appendChild(c),a},k=function(b,c){var d=document.createElement("div");d.classList.add("ChaZD-result-container"),d.setAttribute("data-text",b);var e=document.createElement("div");return e.setAttribute("id","ChaZD-searching"),e.innerHTML="ψ(._. )>划词君正在翻译。。。",d.appendChild(e),chrome.runtime.sendMessage({queryWord:b,source:"select",useHttps:c},function(b){var c=b;if(e.innerHTML="","query success"===c.validMessage){d.innerHTML=c.titleBlock;a(d.querySelector(".voice-container"));var f=document.createElement("div");c.basicBlock&&(f.innerHTML=c.basicBlock,d.appendChild(f)),c.haveTranslation&&(d.querySelector(".title-translation").style.display="block"),c.haveWebTranslation&&(f.innerHTML+=c.webBlock,d.appendChild(f),d.querySelector(".web-title").innerHTML="网络释义"),c.haveTranslation||c.haveWebTranslation||(d.innerHTML="╮(╯▽╰)╭划词君无能为力啊<br> 还是右键问问谷歌君吧=>")}else 20==c.errorCode?d.innerHTML="<p>这段文字太长，词典君无能为力了（┬_┬） <br><br>试试短一点的吧~</p>":40==c.errorCode?d.innerHTML="<p>对不起，这段文字太高深了，请饶过词典君吧（┬_┬）</p>":d.innerHTML="<p>词典君罢工啦（┬_┬）<br><br> 是不是网络不太好？<br><br> 稍后再试一次吧</p>"}),d},l=["ChaZD-result-container","title-container","title-word","title-translation","basic-container","phonetic-container","explains-container","explains-container","explains-list","property-container","explains-item","voice-container","us-phonetic-container","uk-phonetic-container","web-explains-container","web-explains-list","web-key","explains-item-value","web-value"];document.documentElement.addEventListener("mousedown",function(a){for(var b in l)if(a.target.classList.contains(l[b]))return;clearTimeout(d);var c,e,f=document.querySelectorAll(".ChaZD-result-container"),g=document.querySelectorAll(".ChaZD-arrow-main");if(f)for(c=0,e=f.length;c<e;c++)document.documentElement.removeChild(f[c]);if(g)for(c=0,e=g.length;c<e;c++)document.documentElement.removeChild(g[c]);chrome.storage.sync.set({currentWord:""})}),window.addEventListener("resize",function(a){var b=document.querySelector(".ChaZD-result-container"),c=document.querySelector(".ChaZD-arrow-main");b&&document.documentElement.removeChild(b),c&&document.documentElement.removeChild(c)});var m=function(a){if("noSelect"!==f.selectMode){if("useCtrl"===f.selectMode)if("ctrl"===f.toggleKey){if(!a.ctrlKey&&!a.metaKey)return void(e.again=0)}else if("alt"===f.toggleKey){if(!a.altKey)return void(e.again=0)}else if("shift"===f.toggleKey&&!a.shiftKey)return void(e.again=0);g(a)}},n=null,o=function(a){f.linkQuery&&(n=a.target,a.shiftKey&&q(a))},p=function(a){f.linkQuery&&(n&&n.classList.contains("ChaZD-link")&&r(a,!0),n=null)},q=function(a){n&&a.shiftKey&&(s(a),n.setAttribute("ChaZD-href",n.getAttribute("href")),n.removeAttribute("href"),n.classList.add("ChaZD-link"))},r=function(a,b){n&&(b||16==a.keyCode)&&(n.setAttribute("href",n.getAttribute("ChaZD-href")),n.removeAttribute("ChaZD-href"),n.classList.remove("ChaZD-link"))},s=function(a){f.linkQuery&&a.shiftKey&&window.getSelection().empty()};document.documentElement.addEventListener("mouseup",m),document.documentElement.addEventListener("mouseover",function(a){"A"!==a.target.nodeName&&"a"!==a.target.nodeName||o(a)}),document.documentElement.addEventListener("mouseout",function(a){"A"!==a.target.nodeName&&"a"!==a.target.nodeName||p(a)}),document.documentElement.addEventListener("keydown",q),document.documentElement.addEventListener("keyup",r),document.documentElement.addEventListener("selectstart",m)}();